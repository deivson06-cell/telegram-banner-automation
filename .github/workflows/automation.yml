# Executa automaticamente todos os dias Ã s 10:00 (horÃ¡rio UTC)
# Para Brasil: UTC-3, entÃ£o 10:00 UTC = 07:00 BRT
on:
  schedule:
    - cron: '0 10 * * *'  # DiÃ¡rio Ã s 10:00 UTC (07:00 BRT)
  
  # Permite executar manualmente tambÃ©m
  workflow_dispatch:
    inputs:
      test_mode:
        description: 'Modo de teste'
        required: false
        default: 'false'

jobs:
  generate-and-send-banners:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout do cÃ³digo
      uses: actions/checkout@v4
    
    - name: ğŸ Configurar Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: ğŸ“¦ Instalar dependÃªncias
      run: |
        python -m pip install --upgrade pip
        pip install selenium webdriver-manager
    
    - name: ğŸŒ Configurar Chrome
      uses: browser-actions/setup-chrome@latest
      with:
        chrome-version: stable
    
    - name: ğŸ”§ Instalar ChromeDriver
      run: |
        python -c "
        from webdriver_manager.chrome import ChromeDriverManager
        from selenium import webdriver
        ChromeDriverManager().install()
        "
    
    - name: ğŸ¯ Executar automaÃ§Ã£o
      env:
        GERADOR_USERNAME: ${{ secrets.GERADOR_USERNAME }}
        GERADOR_PASSWORD: ${{ secrets.GERADOR_PASSWORD }}
      run: |
        python automation.py
    
    - name: ğŸ“‹ Upload dos logs
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: automation-logs
        path: automation.log
        retention-days: 30

    - name: ğŸ“§ NotificaÃ§Ã£o de sucesso
      if: success()
      run: |
        echo "âœ… Banners gerados e enviados com sucesso!"
        echo "â° Executado em: $(date)"
    
    - name: âŒ NotificaÃ§Ã£o de erro
      if: failure()
      run: |
        echo "âŒ Erro na automaÃ§Ã£o!"
        echo "â° Executado em: $(date)"
        echo "ğŸ“‹ Verifique os logs para mais detalhes."
